{# ===== ذروة - عروض الفلاش مع عداد تنازلي ===== #}
<section class="therwa-flash-sale py-12" style="background-color: {{ theme.color.primary }};">
    <div class="container">
        {# Section Header with Countdown #}
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-2xl">⚡</span>
                    <h2 class="text-2xl md:text-3xl font-bold" style="color: {{ theme.color.reverse_text }};">
                        {{ component.title|default('عروض الفلاش الحصرية') }}
                    </h2>
                </div>
                {% if component.subtitle %}
                <p style="color: rgba(255,255,255,0.8);">{{ component.subtitle }}</p>
                {% endif %}
            </div>
            
            {# Countdown Timer #}
            <div class="flex items-center gap-2">
                <span class="text-sm" style="color: rgba(255,255,255,0.8);">ينتهي خلال:</span>
                <div class="flex gap-2" id="flash-countdown">
                    <div class="countdown-box px-3 py-2 rounded-lg text-center" style="background-color: rgba(255,255,255,0.2);">
                        <span class="block text-xl font-bold" style="color: {{ theme.color.reverse_text }};" id="flash-days">00</span>
                        <span class="text-xs" style="color: rgba(255,255,255,0.7);">يوم</span>
                    </div>
                    <div class="countdown-box px-3 py-2 rounded-lg text-center" style="background-color: rgba(255,255,255,0.2);">
                        <span class="block text-xl font-bold" style="color: {{ theme.color.reverse_text }};" id="flash-hours">00</span>
                        <span class="text-xs" style="color: rgba(255,255,255,0.7);">ساعة</span>
                    </div>
                    <div class="countdown-box px-3 py-2 rounded-lg text-center" style="background-color: rgba(255,255,255,0.2);">
                        <span class="block text-xl font-bold" style="color: {{ theme.color.reverse_text }};" id="flash-minutes">00</span>
                        <span class="text-xs" style="color: rgba(255,255,255,0.7);">دقيقة</span>
                    </div>
                    <div class="countdown-box px-3 py-2 rounded-lg text-center" style="background-color: rgba(255,255,255,0.2);">
                        <span class="block text-xl font-bold" style="color: {{ theme.color.reverse_text }};" id="flash-seconds">00</span>
                        <span class="text-xs" style="color: rgba(255,255,255,0.7);">ثانية</span>
                    </div>
                </div>
            </div>
        </div>
        
        {# Products Slider #}
        <div class="swiper flash-products-swiper">
            <div class="swiper-wrapper">
                {% for product in products.sale|slice(0, 10) %}
                <div class="swiper-slide">
                    <div class="product-card bg-white rounded-2xl overflow-hidden shadow-lg group">
                        {# Product Image #}
                        <div class="relative aspect-square overflow-hidden">
                            <a href="{{ product.url }}">
                                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            </a>
                            {# Discount Badge #}
                            {% if product.discount_percentage %}
                            <span class="absolute top-3 right-3 px-3 py-1 rounded-full text-xs font-bold text-white" style="background-color: #EF4444;">
                                -{{ product.discount_percentage }}%
                            </span>
                            {% endif %}
                            {# Quick Actions #}
                            <div class="absolute bottom-3 left-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button onclick="salla.cart.addItem({{ product.id }})" class="flex-1 py-2 rounded-lg text-sm font-semibold text-white" style="background-color: {{ theme.color.primary }};">
                                    أضف للسلة
                                </button>
                            </div>
                        </div>
                        {# Product Info #}
                        <div class="p-4">
                            <a href="{{ product.url }}" class="block">
                                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2 hover:text-primary transition-colors">{{ product.name }}</h3>
                            </a>
                            <div class="flex items-center gap-2">
                                <span class="text-lg font-bold" style="color: {{ theme.color.primary }};">{{ product.price }}</span>
                                {% if product.regular_price != product.price %}
                                <span class="text-sm text-gray-400 line-through">{{ product.regular_price }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                {# Default products #}
                {% for i in 1..4 %}
                <div class="swiper-slide">
                    <div class="product-card bg-white rounded-2xl overflow-hidden shadow-lg">
                        <div class="aspect-square" style="background-color: {{ theme.color.lighter(0.9) }};"></div>
                        <div class="p-4">
                            <h3 class="font-semibold text-gray-800 mb-2">منتج {{ i }}</h3>
                            <span class="text-lg font-bold" style="color: {{ theme.color.primary }};">99 ر.س</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% endfor %}
            </div>
            
            {# Navigation #}
            <div class="swiper-button-next" style="color: {{ theme.color.reverse_text }}; background-color: rgba(255,255,255,0.3); width: 40px; height: 40px; border-radius: 50%;"></div>
            <div class="swiper-button-prev" style="color: {{ theme.color.reverse_text }}; background-color: rgba(255,255,255,0.3); width: 40px; height: 40px; border-radius: 50%;"></div>
        </div>
        
        {# View All Button #}
        <div class="text-center mt-8">
            <a href="/products?on_sale=1" class="inline-flex items-center gap-2 px-8 py-3 rounded-lg font-semibold transition-all hover:scale-105" style="background-color: #FFFFFF; color: {{ theme.color.primary }};">
                عرض جميع العروض
                <i class="sicon-keyboard-arrow-left"></i>
            </a>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Flash Sale Countdown
    var endDate = new Date();
    endDate.setDate(endDate.getDate() + {{ component.countdown_days|default(3) }});
    
    function updateFlashCountdown() {
        var now = new Date().getTime();
        var distance = endDate - now;
        
        if (distance > 0) {
            document.getElementById('flash-days').textContent = Math.floor(distance / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
            document.getElementById('flash-hours').textContent = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
            document.getElementById('flash-minutes').textContent = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
            document.getElementById('flash-seconds').textContent = Math.floor((distance % (1000 * 60)) / 1000).toString().padStart(2, '0');
        }
    }
    updateFlashCountdown();
    setInterval(updateFlashCountdown, 1000);
    
    // Products Slider
    if (typeof Swiper !== 'undefined') {
        new Swiper('.flash-products-swiper', {
            slidesPerView: 1.2,
            spaceBetween: 16,
            navigation: { nextEl: '.flash-products-swiper .swiper-button-next', prevEl: '.flash-products-swiper .swiper-button-prev' },
            breakpoints: {
                640: { slidesPerView: 2.2 },
                768: { slidesPerView: 3.2 },
                1024: { slidesPerView: 4.2 }
            }
        });
    }
});
</script>
